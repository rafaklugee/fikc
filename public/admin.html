<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
        input, textarea { width: 100%; margin: 5px 0; padding: 10px; }
        button { padding: 10px; background: blue; color: white; border: none; cursor: pointer; }
        .post { margin-bottom: 15px; }
        .post button { background: red; }
    </style>
</head>
<body>
    <h1>Publicar Novo Post</h1>
    <input type="text" id="title" placeholder="Título">
    <textarea id="content" placeholder="Conteúdo"></textarea>
    <input type="text" id="author" placeholder="Autor">
    <input type="file" id="image" accept="image/*">
    <button onclick="createPost()">Publicar</button>

    <h2>Posts Existentes</h2>
    <div id="posts"></div>

    <script>
        // Função para criar um novo post
        async function createPost() {
            const title = document.getElementById("title").value;
            const content = document.getElementById("content").value;
            const author = document.getElementById("author").value;

            const response = await fetch("https://fikc.onrender.com/api/posts", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ title, content, author })
            });

            const result = await response.json();
            alert(result.message);
            fetchPosts();  // Atualiza a lista de posts
        }

        // Função para pegar todos os posts
        async function fetchPosts() {
        const response = await fetch("https://fikc.onrender.com/api/posts");
        const posts = await response.json();
        const postsContainer = document.getElementById("posts");
            
        postsContainer.innerHTML = posts.map(post => `
            <div class="post">
                <h3>${post.title}</h3>
                <p>${post.content}</p>
                <small>Por ${post.author} em ${new Date(post.created_at).toLocaleDateString()}</small>
                ${post.image_url ? `<img src="https://fikc.onrender.com${post.image_url}" style="max-width: 100%; height: auto;">` : ""}
                <br>
                <button onclick="deletePost(${post.id})">Excluir</button>
            </div>
        `).join("");
}


        // Função para excluir um post
        async function deletePost(id) {
            const response = await fetch(`https://fikc.onrender.com/api/posts/${id}`, { method: "DELETE" });
            const result = await response.json();
            alert(result.message);
            fetchPosts();  // Atualiza a lista de posts
        }

        // Carregar os posts quando a página for carregada
        fetchPosts();
    </script>
</body>
</html>
